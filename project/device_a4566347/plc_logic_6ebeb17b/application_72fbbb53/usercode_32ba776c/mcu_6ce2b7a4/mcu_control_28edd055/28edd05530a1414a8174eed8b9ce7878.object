{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)28edd055-30a1-414a-8174-eed8b9ce7878","ParentGuid":"(Guid)72fbbb53-2a88-4ed3-8712-bbc040dc684e","Name":"(string)MCU_Control","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)829a18f2-c514-4f6e-9634-1df173429203","@Value":{"@Type":"829a18f2","@Value":{"ParentObjects":{"@Type":"fa2ee218:IDictionary","@Value":[{"@Key":"(Guid)d9b2b2cc-ea99-4c3b-aa42-1e5c49e65b84","@Value":"(Guid)6ce2b7a4-da04-4adb-a4b6-bcf7265863d1"}]}}}}]},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","829a18f2":"{829a18f2-c514-4f6e-9634-1df173429203}","fa2ee218":"{fa2ee218-a39b-4b6d-b249-49dbddbd168a}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextLines":{"@Type":"[a5de0b0b]","@Value":[{"@Type":"a5de0b0b","@Value":{"Id":"(long)405","Tag":null,"Text":"(string)IF (DI_q_VehicleKL15_DI = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)406","Tag":null,"Text":"(string)\thton_Mileometer(IN := TRUE, PT := T#60S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)407","Tag":null,"Text":"(string)\tIF (gu16_MCU_MaxMotorSpeed_Rx = 0) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)408","Tag":null,"Text":"(string)\t\tgu8_MCU_VMUPollMCU_Multiplex\t:=\tMAXMOTORSPEED;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)409","Tag":null,"Text":"(string)\tELSIF (gu16_MCU_MaxMotorTorque_Rx = 0) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)410","Tag":null,"Text":"(string)\t\tgu8_MCU_VMUPollMCU_Multiplex\t:=\tMAXMOTORTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)411","Tag":null,"Text":"(string)\tELSIF (hton_Mileometer.Q = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)412","Tag":null,"Text":"(string)\t\thton_Mileometer(IN := FALSE, PT := T#0S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)413","Tag":null,"Text":"(string)\t\tgu8_MCU_VMUPollMCU_Multiplex\t:=\tTOTALMOTORROTATION;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)414","Tag":null,"Text":"(string)\tELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)415","Tag":null,"Text":"(string)\t\tgu8_MCU_VMUPollMCU_Multiplex\t:=\t8; (*Not applicable value so will not incorrectly request any data*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)416","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)417","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)418","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)419","Tag":null,"Text":"(string)(*Must be in discharge mode and precharge complete before command out of standby (Need to set ignition at the start always)*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)420","Tag":null,"Text":"(string)IF (gu8_SystemState = DRIVE_SYS AND DOS_q_BatteryDischargeMain_DO = TRUE(* AND gr_MCU_TractionTorqueAvailable > 0*)) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)421","Tag":null,"Text":"(string)\tIF ((gu8_MCU_State = STANDBY) AND gq_Gear_Neutral = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)422","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationRequest\t:=\tOPERATIONAL_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)423","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationalMode_Tx\t:=\tNEU_NOTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)424","Tag":null,"Text":"(string)\tELSIF (gu8_MCU_State = OPERATIONAL) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)425","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationRequest\t:=\tOPERATIONAL_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)426","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationalMode_Tx\t:=\tEV_MODE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)427","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)428","Tag":null,"Text":"(string)ELSIF (gu8_SystemState <> DRIVE_SYS) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)429","Tag":null,"Text":"(string)\tIF (gu8_MCU_State = OPERATIONAL AND gq_Gear_Neutral = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)430","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationRequest\t:=\tSHUTDOWN_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)431","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationalMode_Tx\t:=\tNEU_NOTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)432","Tag":null,"Text":"(string)\tELSIF (gu8_MCU_State = OPERATIONAL AND gq_Gear_Neutral = FALSE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)433","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationRequest\t:=\tOPERATIONAL_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)434","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationalMode_Tx\t:=\tNEU_NOTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)435","Tag":null,"Text":"(string)\t\t(*Rq Neutral*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)436","Tag":null,"Text":"(string)\tELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)437","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationRequest\t:=\tSTANDBY_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)438","Tag":null,"Text":"(string)\t\tgu8_MCU_OperationalMode_Tx\t:=\tNEU_NOTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)439","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)440","Tag":null,"Text":"(string)ELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)441","Tag":null,"Text":"(string)\tgu8_MCU_OperationRequest\t:=\tSTANDBY_RQ;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)442","Tag":null,"Text":"(string)\tgu8_MCU_OperationalMode_Tx\t:=\tNEU_NOTORQUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)443","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)444","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)445","Tag":null,"Text":"(string)(*These values should be set by the BMS*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)446","Tag":null,"Text":"(string)gu16_MCU_MaxChargeCurrent\t\t:=\tREAL_TO_UINT(gr_BMS_CCL);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)447","Tag":null,"Text":"(string)gu16_MCU_MaxDischargeCurrent\t:=\tREAL_TO_UINT(gr_BMS_DCL);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)448","Tag":null,"Text":"(string)gu16_MCU_MaxBatteryVoltage\t\t:=\tgu16_BMS_Maximum_Pack_Voltage;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)449","Tag":null,"Text":"(string)gu16_MCU_MinBatteryVoltage\t\t:=\tgu16_BMS_MinimumPackVoltage;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)450","Tag":null,"Text":"(string)gu8_MCU_CommandMode\t\t\t\t:=\tTORQUE_MODE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)451","Tag":null,"Text":"(string)gu8_MCU_ReferenceCommandMode\t:=\tTORQUE_MODE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)452","Tag":null,"Text":"(string)gr_MCU_MaxMotorSpeed_PreCF\t\t:=\tgr_MCU_MaxMotorSpeed; (*This may need to be set for safety*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)453","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)454","Tag":null,"Text":"(string)IF (gq_Gear_Drive = TRUE OR gq_Gear_DriveCrawl = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)455","Tag":null,"Text":"(string)\ths8_Direction\t:=\t1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)456","Tag":null,"Text":"(string)\tgq_MCU_SpeedCommandStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)457","Tag":null,"Text":"(string)\tgq_MCU_TorqueCommandStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)458","Tag":null,"Text":"(string)ELSIF (gq_Gear_Reverse = TRUE OR gq_Gear_ReverseCrawl = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)459","Tag":null,"Text":"(string)\ths8_Direction\t:=\t-1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)460","Tag":null,"Text":"(string)\tgq_MCU_SpeedCommandStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)461","Tag":null,"Text":"(string)\tgq_MCU_TorqueCommandStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)462","Tag":null,"Text":"(string)ELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)463","Tag":null,"Text":"(string)\ths8_Direction\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)464","Tag":null,"Text":"(string)\tgq_MCU_SpeedCommandStatus\t\t:=\tTRUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)465","Tag":null,"Text":"(string)\tgq_MCU_TorqueCommandStatus\t\t:=\tTRUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)466","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)467","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)468","Tag":null,"Text":"(string)hr_MULTIPLIER_CALC := gr_VehicleSpeed_kmph / WINDUPSPEED;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)469","Tag":null,"Text":"(string)TORQUE_RQ_CF := LIMIT(1(*0.3*), hr_MULTIPLIER_CALC, 1);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)470","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)471","Tag":null,"Text":"(string)Driveability();"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)472","Tag":null,"Text":"(string)IF (gu8_MCU_State = OPERATIONAL AND hs8_Direction <> 0 (*Not in neutral*) AND gq_ABSActive = FALSE AND gq_MCU_CutOff_LowCellV = FALSE AND gq_BodySteps = FALSE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)473","Tag":null,"Text":"(string)\tIF (gq_ABS_TorqueDisable = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)474","Tag":null,"Text":"(string)\t\thton_TorqueRqRamp(IN := FALSE, PT := T#0S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)475","Tag":null,"Text":"(string)\t\tgr_MCU_TorqueCommand_PreCF\t\t\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)476","Tag":null,"Text":"(string)\tELSIF (gq_ZeroTorqueRq = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)477","Tag":null,"Text":"(string)\t\thton_TorqueRqRamp(IN := FALSE, PT := T#0S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)478","Tag":null,"Text":"(string)\t\tIF (gq_RegenActive = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)479","Tag":null,"Text":"(string)\t\t\tgr_MCU_TorqueCommand_PreCF\t:=\t(*gr_MCU_MaxMotorTorque*)gr_MCU_RegenTorqueAvailable * gr_RegenSOCMultiplier * gr_RegenMultiplierRq * gr_RegenSpeedDegrading * gr_RegenIntroCF * (hs8_Direction * (-1)) * LIMIT(0, (gr_TorqueReIntro / gr_TorqueReIntroMax), 1);(**)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)480","Tag":null,"Text":"(string)\t\tELSIF (gq_RegenActive = FALSE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)481","Tag":null,"Text":"(string)\t\t\tgr_MCU_TorqueCommand_PreCF\t\t\t:=\tgr_AccelPedal_Perc * TORQUE_RQ_CF * hs8_Direction * (*gr_MCU_MaxMotorTorque*)gr_MCU_TractionTorqueAvailable * LIMIT(0, (gr_TorqueReIntro / gr_TorqueReIntroMax), 1);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)482","Tag":null,"Text":"(string)\t\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)483","Tag":null,"Text":"(string)\tELSIF (gq_ABS_TorqueDisable = FALSE AND gq_ZeroTorqueRq = FALSE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)484","Tag":null,"Text":"(string)\t\tIF (gq_RegenActive = TRUE) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)485","Tag":null,"Text":"(string)\t\t\thton_TorqueRqRamp(IN := FALSE, PT := T#0S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)486","Tag":null,"Text":"(string)\t\t\tgr_MCU_TorqueCommand_PreCF\t:=\t(*gr_MCU_MaxMotorTorque*)gr_MCU_RegenTorqueAvailable * gr_RegenSOCMultiplier * gr_RegenMultiplierRq * gr_RegenSpeedDegrading * gr_RegenIntroCF * (hs8_Direction * (-1));(**)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)487","Tag":null,"Text":"(string)\t\tELSIF (gq_RegenActive = FALSE) THEN\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)488","Tag":null,"Text":"(string)\t\t\thr_MCU_TorquePreRamp\t:=\tgr_AccelPedal_Perc * TORQUE_RQ_CF * hs8_Direction * (*gr_MCU_MaxMotorTorque*)gr_MCU_TractionTorqueAvailable;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)489","Tag":null,"Text":"(string)\t\t\tgr_MCU_TorqueCommand_PreCF\t:=\thr_MCU_TorquePreRamp;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)490","Tag":null,"Text":"(string)\t\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)491","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)492","Tag":null,"Text":"(string)\t//*DO_q_DrivetrainCoolingFan_DO\t\t:=\tTRUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)493","Tag":null,"Text":"(string)ELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)494","Tag":null,"Text":"(string)\tgr_MCU_TorqueCommand_PreCF\t\t\t:=\t0 * TORQUE_RQ_CF * (*gr_MCU_MaxMotorTorque*)gr_MCU_TractionTorqueAvailable;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)495","Tag":null,"Text":"(string)\t//*DO_q_DrivetrainCoolingFan_DO\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)496","Tag":null,"Text":"(string)\thton_TorqueRqRamp(IN := FALSE, PT := T#0S);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)497","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)498","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)499","Tag":null,"Text":"(string)IF (gu8_BMS_SOC > 10) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)500","Tag":null,"Text":"(string)\tIF (gu8_ChassisType <> CHASSIS_IVECO) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)501","Tag":null,"Text":"(string)\t\thr_TARGETMAXSPEED := SpeedOTG;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)502","Tag":null,"Text":"(string)\tELSIF (gu8_ChassisType = CHASSIS_IVECO) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)503","Tag":null,"Text":"(string)\t\thr_TARGETMAXSPEED := 55;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)504","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)505","Tag":null,"Text":"(string)ELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)506","Tag":null,"Text":"(string)\tIF (gu8_ChassisType <> CHASSIS_IVECO) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)507","Tag":null,"Text":"(string)\t\thr_TARGETMAXSPEED := SpeedOTG1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)508","Tag":null,"Text":"(string)\tELSIF (gu8_ChassisType = CHASSIS_IVECO) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)509","Tag":null,"Text":"(string)\t\thr_TARGETMAXSPEED := 24;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)510","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)511","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)512","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)513","Tag":null,"Text":"(string)IF (gr_VehicleSpeed_kmph > hr_TARGETMAXSPEED) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)514","Tag":null,"Text":"(string)\thr_MaximumTorqueLimit := 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)515","Tag":null,"Text":"(string)ELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)516","Tag":null,"Text":"(string)\thr_IntegralCounter[Counter] := LIMIT(0, (hr_TARGETMAXSPEED - gr_VehicleSpeed_kmph), hr_TARGETMAXSPEED);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)517","Tag":null,"Text":"(string)\tIF (Counter > 49) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)518","Tag":null,"Text":"(string)\t\tCounter := 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)519","Tag":null,"Text":"(string)\tELSE"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)520","Tag":null,"Text":"(string)\t\tCounter := Counter + 1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)521","Tag":null,"Text":"(string)\tEND_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)522","Tag":null,"Text":"(string)\thr_IntegralSum := 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)523","Tag":null,"Text":"(string)\tFOR Cycle := 0 TO 49 DO"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)524","Tag":null,"Text":"(string)\t\thr_IntegralSum := hr_IntegralSum + hr_IntegralCounter[Cycle];"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)525","Tag":null,"Text":"(string)\tEND_FOR"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)526","Tag":null,"Text":"(string)\thr_MaximumTorqueLimit := MAX(((hr_TARGETMAXSPEED - gr_VehicleSpeed_kmph) * hr_SpeedLimit_KP + hr_IntegralSum * hr_SpeedLimit_KI), 0);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)527","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)528","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)529","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)530","Tag":null,"Text":"(string)gr_MCU_SpeedCommand_PreCF\t\t\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)531","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)532","Tag":null,"Text":"(string)gr_MCU_TorqueCommand_PreCF_Limited\t:=\tLIMIT(-3500, gr_MCU_TorqueCommand_PreCF, hr_MaximumTorqueLimit);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)533","Tag":null,"Text":"(string)gr_MCU_ReferenceTorqueCommand_PreCF\t:=\tLIMIT(-3500, gr_MCU_TorqueCommand_PreCF, hr_MaximumTorqueLimit);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)534","Tag":null,"Text":"(string)gr_MCU_ReferenceSpeedCommand_PreCF\t:=\tgr_MCU_SpeedCommand_PreCF;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)535","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)536","Tag":null,"Text":"(string)(*Don't think I need to set these but will keep them here as a reminder and just in case they do need setting*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)537","Tag":null,"Text":"(string)gq_MCU_MaxDiscahrgeCurrentStatus\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)538","Tag":null,"Text":"(string)gq_MCU_MaxBatteryVoltageStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)539","Tag":null,"Text":"(string)gq_MCU_MinBatteryVoltageStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)540","Tag":null,"Text":"(string)gq_MCU_MaxChargeCurrentStatus\t\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)541","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)542","Tag":null,"Text":"(string)gr_VehicleSpeed_kmph\t:=\tf_SpeedCalc(gr_MotorSpeed_IN := gr_MCU_MotorSpeed, gu16_GearRatio_IN := gu16_GearRatio_PreCF,"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)543","Tag":null,"Text":"(string)\t\t\t\t\t\t\t\t\t\tgu16_DyfRatio_IN := gu16_DyfRatio_PreCF, gu16_TireWidth_IN := gu16_TireWidth_mm,"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)544","Tag":null,"Text":"(string)\t\t\t\t\t\t\t\t\t\tgu8_TireProfile_IN := gu8_TireProfile_Perc, gu16_WheelDiameter_IN := gu16_WheelDiameter_PreCF);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)545","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)546","Tag":null,"Text":"(string)gr_VehicleAllTimeDistance\t:=\tf_DistanceCalc(gr_MotorRotation_IN := gr_MCU_TotalMotorRotation, gu16_GearRatio_IN := gu16_GearRatio_PreCF,"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)547","Tag":null,"Text":"(string)\t\t\t\t\t\t\t\t\t\tgu16_DyfRatio_IN := gu16_DyfRatio_PreCF, gu16_TireWidth_IN := gu16_TireWidth_mm,"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)548","Tag":null,"Text":"(string)\t\t\t\t\t\t\t\t\t\tgu8_TireProfile_IN := gu8_TireProfile_Perc, gu16_WheelDiameter_IN := gu16_WheelDiameter_PreCF);"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)549","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)550","Tag":null,"Text":"(string)IF (hq_SetInitialDistance = FALSE AND gr_MCU_TotalMotorRotation <> 0) THEN"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)551","Tag":null,"Text":"(string)\tgr_VehicleInitialTripDistance\t:=\tgr_VehicleAllTimeDistance;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)552","Tag":null,"Text":"(string)\thq_SetInitialDistance\t\t\t:=\tTRUE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)553","Tag":null,"Text":"(string)END_IF"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)554","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)555","Tag":null,"Text":"(string)gr_VehicleTripDistance\t:=\tgr_VehicleAllTimeDistance - gr_VehicleInitialTripDistance;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)556","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)5","Tag":null,"Text":"(string)"}}]}}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextLines":{"@Type":"[a5de0b0b]","@Value":[{"@Type":"a5de0b0b","@Value":{"Id":"(long)2","Tag":null,"Text":"(string)PROGRAM MCU_Control"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)3","Tag":null,"Text":"(string)VAR"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)134","Tag":null,"Text":"(string)\ths8_Direction\t:\tSINT\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)267","Tag":null,"Text":"(string)\thton_Mileometer\t:\tTON;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)276","Tag":null,"Text":"(string)\thq_SetInitialDistance\t:\tBOOL\t:=\tFALSE;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)281","Tag":null,"Text":"(string)\thton_TorqueRqRamp\t:\tTON;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)284","Tag":null,"Text":"(string)\thr_TorqueRampTime\t:\tREAL;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)285","Tag":null,"Text":"(string)\thr_TorqueRampTotal\t:\tREAL;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)305","Tag":null,"Text":"(string)\thr_MCU_TorquePreRamp\t:\tREAL;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)306","Tag":null,"Text":"(string)\thf_TorqueRamp\t\t\t:\tRamp_Linear;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)309","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)307","Tag":null,"Text":"(string)\tTORQUE_RQ_CF\t:\tREAL\t:=\t0.3; (*In case any conversion factors need to be applied to the value being sent*)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)333","Tag":null,"Text":"(string)\thr_MULTIPLIER_CALC\t: REAL\t:= 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)334","Tag":null,"Text":"(string)\tWINDUPSPEED\t\t\t: USINT := 10;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)308","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)344","Tag":null,"Text":"(string)\thr_SpeedLimit_KP\t:\tREAL\t:=\t10;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)345","Tag":null,"Text":"(string)\thr_SpeedLimit_KI\t:\tREAL\t:=\t10;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)346","Tag":null,"Text":"(string)\thfb_SpeedLimit_PID\t:\tPID;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)361","Tag":null,"Text":"(string)\thr_MaximumTorqueLimit : REAL;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)362","Tag":null,"Text":"(string)\thr_TARGETMAXSPEED : REAL := 77;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)372","Tag":null,"Text":"(string)\thr_IntegralCounter : ARRAY [0..49] OF REAL;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)373","Tag":null,"Text":"(string)\tCounter : USINT := 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)381","Tag":null,"Text":"(string)\thr_IntegralSum : REAL := 0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)386","Tag":null,"Text":"(string)\tCycle : USINT;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)4","Tag":null,"Text":"(string)END_VAR"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)1","Tag":null,"Text":"(string)VAR CONSTANT"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)40","Tag":null,"Text":"(string)\tINITIALISATION\t:\tUSINT\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)42","Tag":null,"Text":"(string)\tSTANDBY\t\t\t:\tUSINT\t:=\t1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)43","Tag":null,"Text":"(string)\tSTARTUP\t\t\t:\tUSINT\t:=\t2;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)44","Tag":null,"Text":"(string)\tTEARDOWN\t\t:\tUSINT\t:=\t3;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)45","Tag":null,"Text":"(string)\tOPERATIONAL\t\t:\tUSINT\t:=\t4;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)46","Tag":null,"Text":"(string)\tFAILURE\t\t\t:\tUSINT\t:=\t5;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)47","Tag":null,"Text":"(string)\tCLOSEDOWN\t\t:\tUSINT\t:=\t6;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)48","Tag":null,"Text":"(string)\tREADYTOSHUTDOWN\t:\tUSINT\t:=\t7;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)49","Tag":null,"Text":"(string)\tWAITFORCOOLING\t:\tUSINT\t:=\t8;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)68","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)69","Tag":null,"Text":"(string)\tSHUTDOWN_RQ\t\t:\tUSINT\t:=\t2;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)70","Tag":null,"Text":"(string)\tOPERATIONAL_RQ\t:\tUSINT\t:=\t1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)71","Tag":null,"Text":"(string)\tSTANDBY_RQ\t\t:\tUSINT\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)112","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)113","Tag":null,"Text":"(string)\tTORQUE_MODE\t\t:\tUSINT\t:=\t1;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)114","Tag":null,"Text":"(string)\tSPEED_MODE\t\t:\tUSINT\t:=\t2;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)124","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)125","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)186","Tag":null,"Text":"(string)\t"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)184","Tag":null,"Text":"(string)\tEV_MODE\t\t\t:\tUSINT\t:=\t3;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)189","Tag":null,"Text":"(string)\tNEU_NOTORQUE\t:\tUSINT\t:=\t0;"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)559","Tag":null,"Text":"(string)"}},{"@Type":"a5de0b0b","@Value":{"Id":"(long)41","Tag":null,"Text":"(string)END_VAR"}}]}}}}},"UniqueIdGenerator":"(string)560","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a5de0b0b":"{a5de0b0b-1cb5-4913-ac21-9d70293ec00d}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","long":"System.Int64","string":"System.String"}}},"FormatVersion":"1.0"}